Learning from Clinical Judgments  SemiMarkov Modulated Marked

Hawkes Processes for Risk Prognosis

Ahmed    Alaa    Scott Hu    Mihaela van der Schaar      

Abstract

Critically ill patients in regular wards are vulnerable to unanticipated adverse events which require prompt transfer to the intensive care unit
 ICU  To allow for accurate prognosis of deteriorating patients  we develop   novel continuoustime probabilistic model for   monitored patient   temporal sequence of physiological data 
Our model captures  informatively sampled  patient episodes  the clinicians  decisions on when
to observe   hospitalized patient   vital signs and
lab tests over time are represented by   marked
Hawkes process  with intensity parameters that
are modulated by the patient   latent clinical
states  and with observable physiological data
 mark process  modeled as   switching multitask
Gaussian process  In addition  our model captures  informatively censored  patient episodes
by representing the patient   latent clinical states
as an absorbing semiMarkov jump process  The
model parameters are learned from of ine patient
episodes in the electronic health records via an
EMbased algorithm  Experiments conducted on
  cohort of patients admitted to   major medical
center over    year period show that risk prognosis based on our model signi cantly outperforms the currently deployed medical risk scores
and other baseline machine learning algorithms 

  Introduction
Hospitalized patients are vulnerable to   wide range of
adverse events  including cardiopulmonary arrests  Kause
et al    Hogan et al    Yoon et al    acute
respiratory failures  Mokart    septic shocks  Henry
et al    and postoperative complications  Clifton

 Equal contribution  University of California  Los Angeles 
US   University of Oxford  UK   Alan Turing Institute  UK  Correspondence to  Ahmed    Alaa  ahmedmalaa ucla edu 

Proceedings of the   th International Conference on Machine
Learning  Sydney  Australia  PMLR     Copyright  
by the author   

et al    For   patient in   regular ward  the occurrence of any such event entails an unplanned transfer to an
intensive care unit  ICU  the timing of which is   major
determinant of the eventual outcome  Indeed  recent medical studies have con rmed that delayed transfer to the ICU
is strongly correlated with morbidity and mortality  Mardini      Mokart    The problem of delayed ICU
transfer is enormous and acute  over   septic shocks
and   cardiac arrests occur in the      each year with
mortality rates of   and   respectively  Merchant
et al    Kumar et al    Fortunately  experts believe that much of these events could be prevented with accurate prognosis and early warning  Nguyen et al   
Motivated by the proliferation of electronic health records
 EHRs   currently available in more than   of hospitals in the       Charles et al    we develop   datadriven realtime risk score that can promptly assess   hospitalized patient   risk of clinical deterioration  Our risk
score hinges on   novel continuoustime semiMarkov 
modulated marked Hawkes process model for   monitored
patient   episode       the patient   evolving  latent  clinical states and her corresponding  observed  physiological
data  With the guidance of critical care experts  we conducted experiments on   dataset for   cohort of criticallyill patients admitted to   major academic medical center 
Results show that our risk score offers signi cant gains in
the accuracy  and timeliness  of predicting clinical deterioration  our risk score attains     improvement in the
Area Under Receiver Operating Characteristic  AUROC 
as compared to the technology currently deployed in our
medical center  Since it confers   signi cant prognostic
value in subacute care in wards  the proposed risk score is
currently being installed in our medical center as   replacement for the current technology 
The proposed probabilistic model  based on which our risk
score is computed  captures   hospitalized patient   entire
episode as recorded in the EHR    typical  critical care 
patient episode comprises the time of her admission to the
ward  the time of her admission to the ICU or discharge
from the ward  and   temporal sequence of irregularly sampled physiological data that are collected during her stay in
the ward  Johnson    Ghassemi et al    We model

SemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

  patient   episode as being driven by   latent clinical state
process  which we represent as   semiMarkov jump process  Yu    describing the evolution of the patient  
 severity of illness  over time  All the observable physiological variables are modulated by this process  the times at
which clinicians decide to observe the patient   physiological data are drawn from   Hawkes point process  Hawkes
  Oakes    the intensity of which is modulated by the
patient   clinical state process  whereas the observed physiological data is drawn from   switching multitask Gaussian process with hyperparameters that depend on the patient   clinical state  The patient episode is thus   marked
Hawkes process  with the physiological data serving as the
marks  that is modulated by the patient   clinical states 
We provide   detailed description of the model in Section
  and then propose an EMbased algorithm for learning its
parameters from the EHR data in Section  
  distinctive feature of our model is its ability to incorporate informative clinical judgments into the generative process for the patient   episode  The manifestation of informative clinical judgments in the EHR episodes is doublefaceted  the patients  episodes are both  informatively sampled  and  informatively censored  Informative sampling
results from the fact that clinicians decide to observe the patient   physiological data more intensely if they believe that
the patient is in    bad  clinical state  Moskovitch et al 
  Qin   Shelton      belief that is based on either the clinician   own assessment of the patient   state  or
the communication between the patient and the ward staff
 Kyriacos et al    Informative censoring results from
the clinicians  decision on when to send the patient to the
ICU or discharge her from the ward  which is indeed informative of the   clinical deterioration  or  clinical stability 
onsets  In our model  informative censoring is taken into
account by adopting an absorbing semiMarkov chain as  
model for the patient   latent clinical states    patient   risk
score at any point of time is thus de ned as the probability
of eventual absorption in    clinical deterioration  state 
Related work  Marked point processes have been recently
used in   very different context to model checkin data  Du
et al    Pan et al    but we are not aware of any
attempts for their deployment in the medical context  Most
of the previous works on risk prognosis for critical care
patients viewed informative censoring as    surrogate label  for   patient   clinical deterioration  and hence used
those labels to train   supervised  regression  model using the physiological data in    xedsize time window before censoring  The supervised models used in the literature included logistic regression  Ho et al    Saria
et al    SVMs  Wiens et al    Gaussian processes  Ghassemi et al    Yoon et al    and recurrent neural networks  Che et al    The main limitation
of this approach is that  in addition to the fact that it gener 

ally does not deal with informatively sampled episodes  it
does not model the entire patient   physiological trajectory 
and hence it does not accurately capture intermediate  subtle  deterioration stages that are indicative of future severe
deterioration stages  which leads to   sluggish risk assessment and delayed ICU alarms 
Another strand of literature has focused on building probabilistic models  usually variants of Hidden Markov Models
 HMMs  for the entire patient   physiological trajectories 
applications have ranged from disease progression modeling to neonatal sepsis prediction  Wang et al    Stanculescu et al    These models are not capable of dealing with irregularlysampled data  do not deal with informatively sampled episodes  and are restricted to the Markovianity assumption which entails unrealistically memoryless clinical state transitions  In  Henry et al      ranking algorithm was used to construct   risk score for sepsis
shocks  however  the approach therein requires the clinicians to provide assessments that order the disease severity
at different time instances  we typically do not have such
data in the EHR for ward patients 
Various works in the medical literature have proposed
 expertbased  medical risk scores for prognosis in hospital wards  Morgan et al    Parshuram et al   
some of which are currently used in practice  The medical
literature has also suggested the use of mortality risk scores
that are normally used in the ICU  such as APACHEII and
SOFA  as risk scores for ward patients  Yu et al   
However  recent systematic reviews have demonstrated the
modest net clinical utility of all these scores  Cvach   
More recently    datadriven medical risk score based on  
simple regression model  known as the Rothman index  has
been developed and commercialized  Finlay et al   
Rothman et al    The Rothman index is currently deployed in various major hospitals in the      including our
medical center  in Section   we show that our risk score
signi cantly outperforms the Rothman index in terms of
AUROC and timeliness of ICU admission alarms 

  Structure of the EHR Data
The subacute care data in an EHR typically comprises   set
of episodes  each episode is   sequence of vital signs and
lab tests  physiological data  that have been gathered  by
clinicians  for   hospitalized patient at irregularly spaced
time instances during her stay in   ward  The episode
starts at the time of admission to the ward  and is concluded by either an unplanned admission to the ICU  which
means that the patient was clinically deteriorating  or   discharge from the ward  which means that the patient was
clinically stable  We denote an EHR dataset   that comprises the episodes for   patients as     fE dgD
   where
    is the episode for the dth patient  and is de ned as

SemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

   td
 

 

    ld  with yd

gMd
      

       fyd
  being the mth Qdimensional physiological variable  vital signs and lab test
outcomes  for patient   observed at time td
   and the total number of samples observed for that patient during her
episode is Md  The duration of patient     stay in the ward
is denoted by    
    whereas her endpoint outcome  clinical
deterioration and ICU admission  or clinical stability and
discharge  is declared via   binary variable ld  the realization ld     means that patient   was admitted to the ICU 
and ld     means that the patient was discharged home 
We stress that the labels ld associated with every episode
are neither noisy nor entirely subjective  we assign   label
ld     for patients who actually needed   therapeutic intervention in the ICU after an unplanned admission  and
assign   label ld     for patients who were discharged and
not readmitted shortly after  We excluded all postsurgical
ward patients for whom an ICU admission was preordained
since for those patients the prognosis problem is not relevant  Our dataset comprises thousands of episodes for patients admitted to   large medical center over    year period  all the episodes display the structure described above 
The clinicians were right 
in the dth episode of  
judgments manifest
Clinical
through informative sampling  encoded in the observation
gMd
times ftd
   and informative censoring  encoded in
the episode duration    
  and the endpoint outcome ld  Figure   is   depiction for both informative sampling and informative censoring 
In Figure   we estimate the physiological data  timevarying  sampling rate using all the
episodes in our dataset over   time horizon of   hours before ICU admission for deteriorating patients       patients
with ld     with       being the ICU admission time 
and we compute the same estimates for stable patients      
patients with ld     with       being the discharge time 
We can see from the trends in Figure   that as the deteriorating patient approaches the ICU admission time  the clinicians tend to sample her physiological data more intensely 
whereas as the stable patient approaches the discharge time 
the clinicians tend to have   more relaxed schedule for observing her vital signs and lab tests  The divergence between the sampling rates for deteriorating and stable patient groups increases as the patients approach their ICU
admission and discharge onsets  that is because the clinicians become less uncertain about the patient   state as time
progresses  We have tested the hypothesis that the sampling rate of deteriorating patients is  on average  larger
than that for stable patients in the last   hours before ICU
admission or discharge via   twosample ttest with   signi cance level of   and the hypothesis was accepted 
The takeaway from Figure   is that the clinician   judgment of the patient   clinical state  manifesting in the vital
signs and lab tests sampling rates  is very predictive of the

Figure Estimated sampling rates  with   con dence intervals  for the physiological data over time 

endpoint outcomes  This implies that there is   room for
 learning from the informative clinical judgments  that is 
one can infer the patients  latent states over time by using the clinicians  observable sampling patterns as proximal noisy labels for those latent states 

  The SemiMarkov Modulated Marked

Hawkes Process Model

Now we present   probabilistic model for the episodes
fE dgD
   that captures the informative sampling and censoring effects discussed in Section   We start by modeling
the patient   latent clinical state process in Subsection  
before modeling the observable variables in Subsection  

  Latent Clinical States

We assume that each patient   episode is governed by an
underlying latent clinical state process      that represents
the evolution of her  clinical wellbeing  over time  The
patient   latent clinical state      at any point of time    
          corresponds to the time of admission to the
ward  belongs to    nite space   comprising   states      
               Ng  We model informative censoring by
assuming that states   and   are absorbing states  state  
is the state of clinically stability  at which the patient can
be safely discharged home  whereas state   is the state
of clinical deterioration  at which the patient needs to be
admitted to the ICU  Whenever the patient is in state   or
   her episode is terminated by the clinicians shortly after 
All other states in       Ng are transient states in which
the patient needs vigilant monitoring by the ward staff 
The clinical state process      is   semiMarkov jump pron  Xn  cid     cid   cid   cid    
cess  Yu               
is   semiMarkov process for which every new state realization Xn starts at   jump time  cid    where  cid      and
lasts for   random sojourn time Sn    cid     cid   cid      total
number of   states are realized in the path      where
  is indeed random  and XK      Ng      
the patient   episode is concluded by either clinical deterioration
or stability  The advantage of adopting   semiMarkovian
model for the clinical state process is that unlike Marko 

 

 

 TimetoICUadmission discharge hours Estimatedsamplingrate perhour   ClinicallydeterioratingClinicallystable              SemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

Figure  Depiction of the physiological data sampling times for   clinically deteriorating and   clinically stable patient 

vian models  semiMarkovianity does not imply memoryless transitions  the transition probability from one clinical
state to another at any time depends on the time spent in the
current state    property that has been recently validated in
various clinical state models  Taghipour et al    We
adopt an explicitduration model for the state sojourn times
 Johnson   Willsky    the nth state sojourn time Sn
is drawn from   Gamma distribution  with statespeci  
parameters as follows

Snj Xn       cid  Gamma cid          

 

Since the model includes two absorbing states   and   
for which the notion of sojourn time is inapplicable  we
de ne the variables Sn of such states as the clinicians   response times  for admitting patients to the ICU or discharging them upon the clinical deterioration stability onset  The
transitions among clinical states are governed by   semiMarkov transition kernel matrix      pij          

  Xn    jjXn        pij 

episode   
the marked point process   ym  tm gm   
comprises an observation process ftmgm    which represents the physiological variables  sampling times  and  
mark process fymgm    which represents the realized
physiological variables at these sampling times  The distributional speci cations of our marked point process are
given in the following Subsections 

  THE OBSERVATION PROCESS

We model the observation process generating the physiological variables  observation times ftmgm    as   doubly
stochastic point process whose intensity   cid    is   stochastic process modulated by the latent clinical state process
     In particular  the observation process ftmgm    is
modeled as   onedimensional Hawkes process with   linear selfexciting intensity function  cid          Lee et al 
      

 

 

 cid                 cid  

     cid  

 cid cid     cid tm 

 

 

where selftransitions are eliminated for all transient states
 Yu    Johnson   Willsky         pii       
      Ng  and enforced for the two absorbing states pii  
        Ng  The initial state distribution is given by
   where  cid               Every episode
 cid     cid    
    in an EHR dataset   is associated with   latent clinical
state trajectory fX  
gKd
   but we can only observe the
absorbing state realization XKd   ld in the EHR data 

   Sd
 

  Observable Physiological Data

The patient   latent clinical state process      manifests in
two ways    it modulates the intensity of sampling the patient   physiological variables  informative sampling  and
  it modulates the distributional properties of the observed physiological variables  We capture these two effects via   marked point process model for the patient  

 We model the sojourn time via   Gamma distribution since
it encompasses memoryless exponential distributions of Markov
models as   special case  Liu et al   

 cid   tm  

          where  cid  
     cid   and  cid   are the statedependent in 
 cid cid     cid tm  is an exponential triggertensity parameters   
ing kernel  and  cid      is the time of the most recent jump
In order to ensure the local stationarity of the
in     
Hawkes process within the sojourn time of every latent
          Roueff et al 
state  we assume that  cid  
 cid  
  the expected value of the intensity function is there 
  For  cid      
fore given by   cid                 cid  
 cid   cid  
or  cid       we recover   modulated Poisson process as  
special case  Pan et al   
In Figure   we depict the observation times in two patients 
episodes  patient   being   clinically deteriorating patient 
and patient   being   clinically stable patient  We can see
that patient     episode had its sampling rate escalating as
her condition was worsening  the sampling rate remained
intense after she was admitted to the ICU  On the other
hand  patient     episode exhibited   decelerating sampling
rate on her path to clinical stability  We can also notice that

 cid  

 

 Time hours Labtestsandvitalsignssamplingtimes   Time hours   PatientA clinicallydeterioratingPatientB clinicallystablepatientPatientAPatientBDischargeonsetIntensiveCareHospitalizationinregularwardHospitalizationinregularwardICUadmissiononsetSemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

the observation times display   subtle  clustered  pattern
that point out to their temporal dependencies  indeed  the
clinicians are not memoryless  and the times at which they
observe the physiological data are dependent  In the light of
the above  the modulated Hawkes process described above
appears to be   sensible model for the observation process
ftmgm    as it captures both the timevarying intensity
and the temporal dependencies illustrated in Figure  

  THE MARK PROCESS

Now we provide the distributional speci cation of the mark
process fymgm    Since the physiological data are irregularly sampled from an underlying continuoustime physiological process       at the sampling times determined by
the observation process ftmgm      convenient model for
      is   switching Gaussian Process de ned as follows 
       

 
   Yn     cid   cid   cid      with
Yn     Xn       cid  GP mi    ki     

 

 

 

 

 

where mi    and ki     
  are the statedependent mean
function and covariance kernel  respectively  We use   constant mean function mi      mi and   Mat ern kernel given
by

 vi cid   

  
Kvi cid   
   cid vi  cid   
   

 

 

 vi cid   

 

 vi cid  jt cid  

  

  

 

  

 

   

ki     

 vi cid  jt cid  

  

  

 

 

 
where vi               cid  is the Gamma function and
  is   modi ed Bessel function  Rasmussen   
Kvi cid   
Our choice for the Mat ern kernel is motivated by its ability
to represent various commonly used stochastic processes 
for instance  when vi     then Yn     Xn      is an
OrnsteinUhlenbeck process  Rasmussen    whereas
for   general integer value of vi  Yn     Xn      is  
continuoustime analogue of the Autoregressive process
AR vi    process that has been widely used to model
physiological timeseries data  Stanculescu et al   
By constructing Yn    as   continuoustime analog of the
   Yn     cid   cid   cid cid    
AR model  the process        
becomes   continuoustime switching AR model that is
modulated by the patient   latent clinical state process
     We observe the continuoustime process       only
at the sampling times dictated by the observation process
 tm      and the resulting process fymgm    de nes
the mark process  The observation process together with
the mark process  both modulated by the latent clinical state
process      constitute   marked Hawkes process  which
completely describes   patient   episode 
The mark process de ned above is onedimensional  and
hence we need to extend the de nition to handle   multidimensional process that represents multiple lab tests and

 

vital signs  In other words  we seek   continuoustime analog of the switching Vector Autoregressive  VAR  model
rather than an AR model  This is achieved by adopting   multitask Gaussian Process as   model for the Qdimensional physiological process         RQ  Durichen
et al    That is  we assume that Yn     Xn  
    cid  GP mi    Ki     
 
  where the covariance kernel
    fki           
 gQ
 
     is based on the intrinsic
Ki     
correlation model  Bonilla et al         Ki     
  can
be written in the following separable form
     cid          cid  ki     

ki           

 

 

 

 

 

 

 

  is the covariance between the rth physwhere ki           
iological variable at time   and the gth physiological vari 
   cid   is      cid    intrinsic correlation maable at time  
 
  is the Mat ern kernel in   For evtrix  and ki     
ery state    we denote the multitask GP parameter set as
  and the Hawkes process parame 
 cid      mi    Ki     
ter set as  cid    The entire model parameters can be bundled
in the parameter set   as follows

 

    fP   cid     cid     cid     cid     Xg 

Given   parameter set   we can easily generate sample
patient episodes from our model by  rst sampling   state
sequence fX        XKg using the semiMarkov transition
kernel  then sampling   corresponding sequence of sojourn
times fS        SKg from the statedependent Gamma distributions  then sampling   set of multitask Gaussian process fY          YK      and  nally sampling   sequence
of observation times ftmgM
   using Ogata   modi ed thinning algorithm  Ogata    Figure   depicts one patient
episode sampled from our model   An algorithm for sampling episodes from our model is provided in Appendix  
in the supplementary material 

  Learning and Inference
In this Section  we develop an of ine learning algorithm
that learns the model parameter   using the of ine training
episodes in    and   realtime risk scoring algorithm that
computes   hospitalized patient   risk over time  The learning algorithm operates by  rst detecting changepoints in
the physiological data and the observation process  using
the detected changepoints  the algorithm segments each
episode into   sequence of states  and uses an EM algorithm to estimate the model parameters  The realtime risk
scoring algorithm operates by inferring the patient   current
state via forward ltering  and then computing the probability of eventual absorption in the deteriorating state 

 In Appendix   of the supplementary material  we establish
the connection between the switching multitask Gaussian Process model described herein and the conventional VAR model 
showing that the former is the continuoustime analog of the latter 

SemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

 

 

Kd

 

    Sd

 cid   cid   

Di  

Kd      

 ym  tm ftm cid cid   

Kd   ld            

times as  Sd
observable  subdataset Di as follows

Kd   cid     cid     De ne the  fully
 
            Given such   fully  edged speci cation of the
absorbing states  onsets  identities  and the corresponding
physiological variables  we can directly apply MLE to estimate the parameters  cid   cid      cid   cid      cid  and  cid     Using
the dataset Di  the parameter  cid   is estimated using the gradient method for Gaussian processes as in  Bonilla et al 
   cid   is estimated using the standard MLE estimating
equations  and  cid   is estimated by maximizing the recursive
likelihood formula in  Ogata    using the NelderMead
simplex method  Nelder   Mead   
Step   Estimation of the transient states  parameters using the EM algorithm
While the absorbing states are observable  the transient
states are all hidden  In order to estimate the parameters
      cid igN cid 
    cid igN cid 
     we use the jump
times  estimates   cid   
   obtained from step  
in order to segment every episode   into   set of  nite transition  and hence we obtain   discretetime HMMlike process  We truncate all the episodes by removing the data
belonging to the absorbing state  and run the EM algorithm
in order to estimate the transient state parameters  The EM
algorithm takes advantage of informative censoring in the
forwardbackward message passing stage by computing the
backward messages conditioned on the identity of the endpoint absorbing state ld for every episode   

     and   cid igN cid 
           cid   

Kd cid 

  The Realtime Risk Scoring Algorithm
Having learned the model parameters   from an of ine
dataset    we now explain how risk scoring is conducted
in realtime for   newly hospitalized patient  The patient
risk score at time   is denoted by      and is de ned as
                jfym  tmg  tm  cid       That is 
the risk score      is the probability of being eventually
absorbed in the deteriorating state   given the observable
physiological data up to time    Using Bayes  rule  the risk
score      is given by

 
 
         ijfym  tmg 

  

 
 
 cid                      

  

 

 

   

Current state

Future transition

where the  current state  term is computed in realtime using the ef cient  dynamic programming  forward ltering
algorithm  whereas the  future transition  term is computed
of ine using the estimated model parameters 

  Experiments
In order to evaluate the prognostic utility of our model  we
conducted experiments on   dataset   comprising informa 

Figure  An episode sampled from the proposed model 

   Sd
 

  The Of ine Learning Algorithm
Estimating the model parameters   from the dataset    
fE dgD
   is   daunting task due to the hiddenness of the
gD
patients  clinical state trajectories fX  
   an application of MCMCbased inference methods  such as the
method in  Qin   Shelton    will incur an excessive computational cost for   complex model like ours 
We therefore developed an ef cient threestep learning algorithm that capitalizes on the structure of the patients 
episodes in order to  nd   point estimate   for   The three
steps of the our learning algorithm are listed hereunder 
Step   Changepoint detection
Kdg for evWe  rst estimate the jump times   cid   
ery episode     in    This is achieved by using the
Edivisive changepoint detection algorithm  Matteson  
James    Since the Edivisive algorithm is nonparametric  we are able to estimate the onsets of all clinical
states      
the jump times of        prior to  nding the
estimate   We let the Edivisive algorithm jointly detect changes in the distributions of the observable variables
gMd
fyd
   by creating an augmented vector of observables that comprises
both the physiological observations and    differential  observation process      
  cid   
           cid   

   and the observation process ftd
gMd

         yd

           cid   

      td

     td

 

 

    

Kdg   Edivisive yd
    td
 

 cid  td

  cid  with  td

where  td
      By the end of
this step  we obtain an estimate for the start and end times
of all clinical state realizations for every episode     
Step   Maximum Likelihood Estimation  MLE  of the
absorbing states  parameters
By virtue of informative censoring  we know the identities
Kd   ld    Now that
of all the absorbing states          
we have estimates for the onsets of the absorbing states 
obtained from step   then we can estimate the response

 The details for all the algorithms in this Section are provided

in Appendix   in the supplementary material 

 TimetLatentStatesandIntensityFunctionClinicalstatespaceisX state isthe clinicaldeterioration state    TimetPhysiologicalVariables      ym Mm Intensityfunction       ClinicalstateprocessX   Observationprocess tm Informativecensoringl       SemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

tion on patient admissions to   major medical center over
   year period  and compared the proposed risk score de 
 ned in Subsection   with other competing baselines  We
brie   describe our dataset in the next Subsection  and then
present the experimental results    very detailed description for our dataset and the implementation of the baselines
is provided in Appendix   in the supplementary material 

  Data Description
Each patient record in   is an episode that is formatted
as described in Section   The patients  cohort in   is
very heterogeneous  diagnoses included sepsis  hypertension  renal failure  leukemia  septicemia and pneumonia 
Each patient   episode in   comprises   vital signs and lab
tests that are collected for the patient over time  along with
the time instances at which they where collected  The vital
signs include diastolic and systolic blood pressure  Glasgow coma scale score  heart rate  eye opening  respiratory
rate  temperature     saturation and device assistance  best
motor and verbal responses  The lab tests included measurements of chloride  glucose  urea nitrogen  white blood
cell count  creatinine  hemoglobin  platelet count  potassium  sodium and CO  In all the experiments conducted in
this Section  we split   into   training set with admissions
over    year period   episodes  and   testing set
with admissions over    month period   episodes 

  Results

We ran the of ine learning algorithm in Subsection  
 with   EM iterations  on the   training episodes
in    and obtained an estimate   for the semiMarkov 
modulated marked Hawkes process that describes the patient cohort  Using the Bayesian information criterion  we
selected an instantiation of our model with   clinical states 
where state   is the clinical stability  absorbing  state  and
state   is the clinical deterioration  absorbing  state  The
learned Hawkes process intensity functions for these two
states are given by

 
 

tm

tm

  
  

 

 
 

   

 

 cid   cid tm 

Temporal dependencies  
 cid   cid tm 

   

 

 

 
 

Temporal dependencies  

 cid       

 cid       

   
   

Baseline intensity  

Baseline intensity  

where  cid         is measured in samples per hour  We
note that the estimated Hawkes process parameters accurately describe the clinicians  judgments  when the patient
is in the deteriorating state  state   the clinicians tend to
observe her physiological measurements more frequently 
This manifests in the baseline intensity of  cid      being

Figure  An episode for   hospitalized cardiac patient 

  higher than that of  cid      Moreover  we note that
when the patient is clinically stable  state   the temporal
dependencies between the observation times almost disappear as the exponential triggering kernel plays little role
in determining the observation times        cid       cid   
which renders the observation process closer to   Poisson process  Contrarily  when the patient is deteriorating 
strong temporal dependencies are displayed in the observation times  this is intuitive since for   deteriorating patient 
the followup times decided by the clinicians strongly depend on what have been observed in the past  These distinguishing statespeci   features of the clinical judgments
are the essence of informative sampling  which allows us
to integrate physiological data together with clinical experience while learning the patient   physiological model 
We illustrate the value of informative sampling in Figure  
through an episode for   cardiac patient who was admitted
in the ward for   week before being sent to the ICU upon  
cardiac arrest  When running the of ine learning algorithm
in Section   while assuming that the observation process
gm is uninformative        cid          cid                
ftd
the detected clinical deterioration onset is only   hours
ahead of the cardiac arrest event  onset   in Figure  
this is because the states are estimated solely based on
the physiological data  and hence the clinical deterioration
state is detected only when the patient   heart rate fell below   beats per minute  BPM  When running the learning again but with informative sampling taken into account 
the detected clinical deterioration onset is   hours ahead
of the cardiac arrest event  onset   in Figure   this is
the time instance at which the clinicians decided to monitor the patient more vigilantly       more intense sampling
rate  even though the evidence for an upcoming cardiac
arrest in her heart rate trajectory was rather subtle  The
clinicians  decision to intensely observe the patient   physiological trajectory is based either on their experience  or
on apparent symptoms or complains from the patient that
were not recorded in the EHR  By integrating the clinicians  judgments into our model  we are able to capture the
subtleties in the patients  temporal physiological parameters  and hence learn more accurate representations for the
clinical states 

 

 Timeinhours ICUadmissionatt HearRate BPM Admissiontotheward ObservationprocessSemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

Method

Proposed Score

Rothman Index

Medical Scores

ML Algorithms

MEWS

APACHEII

SOFA
SWRF
HMMs
SWGP
SWLR

AUROC

 
 
 
 
 
 
 
 
 

Table Comparison between various risk scoring methods     
   SW  Slidingwindow  GP  Gaussian process regression 
LR  Logistic Regression  RF  Random Forests 

We then computed the realtime risk score  as described
in Subsection   for the testing episodes  and compared
its sensitivityprecision AUCROC with that of the baseline
risk scoring methods listed hereunder 

Medical Risk Scores  we considered the two most
commonly used medical risk scores in regular wards  the
MEWS score  Morgan et al    and the Rothman index   Rothman et al    We implemented the MEWS
score and the Rothman index as described in  Kyriacos
et al    and  Rothman et al    respectively  We
also compared with the APACHEII and SOFA scores 

Machine Learning Algorithms  we considered the
traditional approach for realtime risk scoring  which treats
informative censoring as   surrogate label based on which
  supervised regression model is learned of ine  and then
risk scoring is applied in realtime using the temporal data
within   sliding window  we call these methods  slidingwindow methods  We implemented slidingwindow
methods based on logistic regression  Ho et al   
Saria et al    random forests  and Gaussian process
regression  Ghassemi et al    Yoon et al   
In addition  we compared our risk score with   standard
Hidden Markov Model with Gaussian emissions  The
relevant physiological measurements for every baseline
were selected through the correlated feature selection
method  Yu   Liu    The hyperparameters of all
the baselines  including the size of the sliding window
for the supervised learning methods  were optimized via
crossvalidation  To handle the irregularly sampled data 
we discretized the time horizon into  hour steps and fed
the baselines with interpolated  discretetime episodes 
In Table   we compare the performance of our risk score
with the baselines in terms of the sensitivityprecision AU 

 At the time of conducting these experiments  the Rothman

index was deployed in more than   major hospitals in the US 

ROC  As we can see  the proposed risk score offers    
AUROC improvement as compared to the best performing medical risk score  the Rothman index  which was the
score deployed in our medical center at the time of conducting this experiment  Moreover  our risk score also provides
signi cant gains over discriminative slidingwindow regression models  the proposed risk score achieves    
AUROC improvement as compared to the best performing ML algorithm  random forest 
In addition  the proposed risk score achieves     AUROC improvement as
compared to   standard HMM with Gaussian emission variables  On average  our risk score prompts ICU alarms  
hours before the censoring time at   sensitivity of   and
precision of  

 

  Discussion  Chickenand egg
We stress that while computing our risk score for the testing episodes  we did not use the information conveyed in
the observation process ftd
gm to infer the patients  clinical states  This is because in practice  the value of the realtime risk score      itself in uences the clinician   behavior and hence impacts the observation process  creating  
chickenand egg dilemma in which one cannot clearly conceptualize the causal relation between the risk score and the
clinicians  judgments    very interesting research direction
is to consider an observation process that is modulated by
both the patient   state and the realtime risk score through
an intensity function  cid              where the algorithm
learns the clinical state representation online by  sharing
experience  with the clinicians  That is  the algorithm uses
the clinician   judgments to re ne its clinical state model 
which leads to   re ned risk score      that would in turn
allow the clinician to exhibit more accurate judgments  an
online learning process that would ideally converge to  
state of  shared knowledge  between the clinician and the
system 
The signi cant prognostic value offered by our risk score
promises   great improvement in the quality of subacute
care in wards  By utilizing the proposed score instead of
the current technology  clinicians in   crowded ward can
better focus their attention on patients at real risk of deterioration  and can also plan for timely ICU admissions and effective therapeutic interventions  With the high inhospital
mortality rates in wards  deploying our risk score may help
save thousands of lives annually  we are currently working
towards installing the proposed risk score in our medical
center 

 The adoption of   semiMarkovian model for the clinical state
process protects our model from the overtly rapid state switching
behavior that is introduced by memoryless HMMs  Matteson  
James   

SemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

References
Bonilla  Edwin    Chai  Kian    and Williams  ChristoIn Adpher  Multitask gaussian process prediction 
vances in neural information processing systems  pp 
   

Charles     Gabriel     and Henry     Electronic capabilities for patients among us nonfederal acute care hospitals    onc data brief   of ce of the national
coordinator for health information technology  Washington dc   

Che  Zhengping  Purushotham  Sanjay  Cho  Kyunghyun 
Sontag  David  and Liu  Yan  Recurrent neural networks
for multivariate time series with missing values  arXiv
preprint arXiv   

Clifton  Lei  Clifton  David    Pimentel  Marco AF 
Watkinson  Peter    and Tarassenko  Lionel  Gaussian process regression in vitalsign early warning systems  In Engineering in Medicine and Biology Society
 EMBC    Annual International Conference of the
IEEE  pp    IEEE   

Cvach  Maria  Monitor alarm fatigue  an integrative review  Biomedical instrumentation and technology   
   

Du  Nan  Dai  Hanjun  Trivedi  Rakshit  Upadhyay 
Utkarsh  GomezRodriguez  Manuel  and Song  Le  Recurrent marked temporal point processes  Embedding
event history to vector  In Proceedings of the  nd ACM
SIGKDD  pp    ACM   

Durichen  Robert  Pimentel  Marco AF  Clifton  Lei 
Schweikard  Achim  and Clifton  David    Multitask
gaussian processes for multivariate physiological timeseries analysis  Biomedical Engineering  IEEE Transactions on     

Finlay    Duncan  Rothman  Michael    and Smith 
Robert    Measuring the modi ed early warning score
and the rothman index  advantages of utilizing the electronic medical record in an early warning system  Journal of hospital medicine     

Ghassemi  Marzyeh  Pimentel  Marco AF  Naumann  Tristan  Brennan  Thomas  Clifton  David    Szolovits  Peter  and Feng  Mengling    multivariate timeseries modeling approach to severity of illness assessment and forecasting in icu with sparse  heterogeneous clinical data  In
AAAI  pp     

Hawkes  Alan   and Oakes  David    cluster process representation of   selfexciting process  Journal of Applied
Probability  pp     

Henry  Katharine    Hager  David    Pronovost  Peter   
and Saria  Suchi    targeted realtime early warning
score  trewscore  for septic shock  Science Translational
Medicine   ra ra   

Ho  Joyce    Lee  Cheng    and Ghosh  Joydeeph 
Imputationenhanced prediction of septic shock in icu
patients  In Proceedings of the ACM SIGKDD Workshop
on Health Informatics  pp     

Hogan  Helen  Healey  Frances  Neale  Graham  Thomson 
Richard  Vincent  Charles  and Black  Nick  Preventable
deaths due to problems in care in english acute hospitals 
  retrospective case record review study  BMJ quality  
safety  pp  bmjqs   

Johnson  Alistair EW  et  al  Mimiciii    freely accessible

critical care database  Scienti   data     

Johnson  Matthew   and Willsky  Alan    Bayesian nonparametric hidden semimarkov models  Journal of Machine Learning Research   Feb   

Kause  Juliane  Smith  Gary  Prytherch  David  Parr 
Michael  Flabouris  Arthas  Hillman  Ken  et al   
comparison of antecedents to cardiac arrests  deaths and
emergency intensive care admissions in australia and
new zealand  and the united kingdomthe academia study 
Resuscitation     

Kumar  Gagan  Kumar  Nilay  Taneja  Amit  Kaleekal 
Thomas  Tarima  Sergey  McGinley  Emily  Jimenez 
Edgar  Mohan  Anand  Khan  Rumi Ahmed  Whittle 
Jeff  et al  Nationwide trends of severe sepsis in the  st
century   Chest Journal   
 

Kyriacos  Una  Jelsma  Jennifer  James  Michael  and Jordan  Sue  Monitoring vital signs  development of   modi ed early warning scoring  mews  system for general
wards in   developing country  PloS one     
 

Lee  Young  Lim  Kar Wai  and Ong  Cheng Soon  Hawkes
processes with stochastic excitations  pp     

Liu  YuYing  Li  Shuang  Li  Fuxin  Song  Le  and Rehg 
James    Ef cient learning of continuoustime hidden
markov models for disease progression  In Advances in
neural information processing systems  pp   
 

Mardini    Lipes    Jayaraman    Adverse outcomes associated with delayed intensive care consultation in medical and surgical inpatients  Journal of critical care   
   

SemiMarkov Modulated Marked Hawkes Processes for Risk Prognosis

Matteson  David   and James  Nicholas      nonparametric approach for multiple change point analysis of multivariate data  Journal of the American Statistical Association     

Merchant  Raina    Yang  Lin  Becker  Lance    Berg 
Robert    Nadkarni  Vinay  Nichol  Graham  Carr  Brendan    Mitra  Nandita  Bradley  Steven    Abella  Benjamin    et al 
Incidence of treated cardiac arrest in
hospitalized patients in the united states  Critical care
medicine     

Mokart  Djamel et  al  Delayed intensive care unit admission is associated with increased mortality in patients
with cancer with acute respiratory failure  Leukemia  
lymphoma     

Morgan  RJM  Williams     and Wright  MM  An early
warning scoring system for detecting developing critical
illness  Clin Intensive Care     

Moskovitch  Robert  Walsh  Colin  Wang  Fei  Hripcsak 
George  and Tatonetti  Nicholas  Outcomes prediction
In Data Mining
via time intervals related patterns 
 ICDM    IEEE International Conference on  pp 
  IEEE   

Nelder  John   and Mead  Roger    simplex method for
function minimization  The computer journal   
   

Nguyen    Bryant  Corbett  Stephen    Steele  Robert 
Banta  Jim  Clark  Robin    Hayes  Sean    Edwards 
Jeremy  Cho  Thomas    and Wittlake  William    Implementation of   bundle of quality indicators for the
early management of severe sepsis and septic shock
is associated with decreased mortality  Critical care
medicine     

Ogata  Yosihiko  On lewis  simulation method for point
IEEE Transactions on Information Theory 

processes 
   

Pan  Jiangwei  Rao  Vinayak  Agarwal  Pankaj    and
Gelfand  Alan    Markovmodulated marked poisson
In Proceedings of ICML 
processes for checkin data 
pp     

Parshuram  Christopher    Hutchison  James  and Middaugh  Kristen  Development and initial validation of
the bedside paediatric early warning system score  Crit
Care       

Qin  Zhen and Shelton  Christian    Auxiliary gibbs sampling for inference in piecewiseconstant conditional intensity models  In UAI  pp     

Rasmussen  Carl Edward  Gaussian processes for machine

learning   

Rothman  Michael    Rothman  Steven    and Beals 
Joseph  Development and validation of   continuous
measure of patient condition using the electronic medical record  Journal of biomedical informatics   
   

Roueff  Franc ois  Von Sachs  Rainer  and Sansonnet 
Laure  Locally stationary hawkes processes  Stochastic Processes and their Applications   
 

Saria  Suchi  Rajani  Anand    Gould  Jeffrey  Koller 
Daphne  and Penn  Anna    Integration of early physiological responses predicts later illness severity in preterm
infants  Science translational medicine   ra 
 ra   

Stanculescu  Ioan  Williams  Christopher KI  and Freer 
Yvonne  Autoregressive hidden markov models for
IEEE journal
the early detection of neonatal sepsis 
of biomedical and health informatics   
 

Taghipour     Banjevic     Miller  AB  Montgomery    
Jardine  AKS  and Harvey  BJ  Parameter estimates for
invasive breast cancer progression in the canadian national breast screening study  British journal of cancer 
   

Wang  Xiang  Sontag  David  and Wang  Fei  Unsupervised
learning of disease progression models  In Proceedings
of the  th ACM SIGKDD  pp    ACM   

Wiens  Jenna  Horvitz  Eric  and Guttag  John    Patient
risk strati cation for hospitalassociated    diff as   timeseries classi cation task  In Advances in Neural Information Processing Systems  pp     

Yoon     Alaa     Hu     and van der Schaar     Forecasticu    prognostic decision support system for timely
prediction of intensive care unit admission  Proceedings
of ICML  pp     

Yu  Lei and Liu  Huan 

Feature selection for highdimensional data    fast correlationbased  lter solution  In ICML  volume   pp     

Yu  Shun  Leung  Sharon  Heo  Moonseong  Soto  Graciela    Shah  Ronak    Gunda  Sampath  and Gong 
Michelle Ng  Comparison of risk prediction scoring
systems for ward patients    retrospective nested casecontrol study  Critical Care     

Yu  ShunZheng  Hidden semimarkov models  Arti cial

Intelligence     

